---
title: 设备管理
date: 2020-03-16 11:15:31
categories: 
    - 操作系统
tags: 
    - deviceManager
---

对计算机系统内所有设备实施有效管理

# 功能

- 设备分配
- 设备传输控制
- 设备独立

# I/O管理

| I/O设备分类          |                                                              |
| -------------------- | ------------------------------------------------------------ |
| 按设备的使用特性分类 | 存储设备、人机交互设备(输入输出设备)、网络通信设备(网络接口、调制解调器) |
| 按信息交换单位分类   | 字符设备(键盘、显示器)、块设备(磁盘)                         |
| 按传输速率分类       | 低速设备(键盘、鼠标)、中速设备(打印机)、高速设备(磁带机、磁盘) |
| 按设备共享属性分类   | 独占设备、共享设备、虚拟设备                                 |

| I/O设备功能 | 解释                           |
| ----------- | ------------------------------ |
| 设备分配    | 将I/O设备分配给哪个进程        |
| 设备处理    | 启动I/O操作，处理I/O的中断请求 |
| 缓冲管理    | 缓和CUP与I/O速度不匹配问题     |
| 设备独立性  | 应用程序独立于物理设备         |

## 设备控制器

当只有一个I/O时，它只有一个设备地址。当它控制多个I/O时，具有多个设备地址。

功能

- 接收识别CPU的各种指令
- 实现CPU与设备控制器、设备控制器与设备之间的数据交换
- 记录设备的状态供CPU查询
- 识别所控制的每个设备的地址
- 对CPU输出的数据或设备向CPU输入的数据进行缓冲
- 对输入\输出数据进行差错控制

## 控制方式

### 程序直接控制方式

CPU与I/O通信，需要不断测试I/O设备，利用率低，简单

### 中断控制方式

输入完成，向CPU发送中断信号，CPU执行中断处理程序，提高了CPU利用率，中断次数多，耗费大量CPU处理时间。

- 唤醒被阻塞的驱动进程：signal操作
- 保护被中断进程的CPU环境：将处理器状态字PSW和程序计数器PC压入栈中加以保存，CPU寄存器也压入栈中
- 转入想要的设备处理程序
- 中断处理
- 恢复被中断进程的现场

### DMA控制方式

- 数据传输的基本单位是数据块
- 数据是单向传输
- 仅在传送一个或多个数据块的开始和结束时才需要CPU干预，传送一批数据后才中断CPU
- 组成：
  - 命令/状态寄存器（CR）接收从CPU发来的I/O命令或有关控制信息
  - 内存地址寄存器（MAR）用于存放数据从设备传送到内存或从内存到设备的内存地址
  - 数据寄存器（DR）用于暂存从设备到内存或从内存到设备的数据
  - 数据计数器（DC）存放本次要传送的字数
- 优点：与CPU并行
- 缺点：起始地址，传送数据长度等都由CPU控制，每台设备需要DMA控制器，设备增加，不经济

### 通道控制方式

- 起始地址，传送数据长度等都由通道管理，一个通道可以控制多台设备
- 字节多路通道：以字节为单位，交叉轮流为多个设备服务
- 数组选择通道：可以连接多台高速设备，只含有一个分配型子通道，利用率低
- 数组多路通道：广泛连接中高低速设备，含有多个非分配型子通道
- 优点：可以与CPU并行
- 缺点：成本高

## 软件层次结构

- 硬件
- 中断处理程序
  - 见上面中断控制方式
- 设备驱动程序
  - 将参数要求转化为具体要求
  - 检查I/O的合法性
  - 读出和检查设备的状态
  - 传送必要参数
  - 设置必要方式
  - 启动I/O设备
- 设备独立性软件
  - 向用户空间软件提供统一的接口
- 用户层软件

# 高速缓存与缓冲区

配合CPU的速度

## 分类

单缓冲：等待上一行输出完毕才能继续输出

双缓冲：前一个数据可以装入另一个缓冲区，两个轮换使用

循环缓冲：最后一个缓冲区指向第一个缓冲区构成循环，当需要数据是从缓冲区取出一个装满数据的缓冲区

缓冲池

- 共多个队列共享，既可以输入也可以输出
- 三种状态
  - 空缓冲队列
  - 装满输入数据的缓冲队列
  - 装满输出数据的缓冲队列
- 四个工作缓冲区
  - 收容输入数据的工作缓冲区
  - 提取输入数据的工作缓冲区
  - 收容输出数据的工作缓冲区
  - 提取输出数据的工作缓冲区

## 区别

- 存放数据不同：高速缓存存放低速设备的一个备份，缓冲区则存放低速到高速的一个数据
- 目的不同：高速缓存存放经常使用的数据，缓冲区解决速度不匹配

# 设备分配与回收

## 设备管理中的数据结构

- 设备控制表DCT：用来指示设备当前状态
- 设备控制器控制表COCT：反应设备控制器的使用状态
- 通道控制表CHCT：反应通道的状态
- 系统设备表SDT：已连接到系统中的所有物理设备

## 设备分配策略

- 设备的使用性质
  - 独享设备
  - 共享分配
  - 虚拟分配：针对虚拟设备
- 设备分配算法
  - 先来先服务
  - 优先级高者优先
- 设备分配的安全性
  - 保证不发生死锁
  - 静态分配：在作业开始前就一次性分配好
  - 动态分配：根据需要进行设备分配

## 设备独立性

- 指应用程序独立于具体使用的物理设备
- 通过逻辑设备表来对应逻辑设备和物理设备

## 设备分配程序

- 单通路I/O系统的设备分配：分配设备->分配设备控制器->分配通道
- 多通路I/O系统的设备分配：一个设备与多个设备控制器相连，设备控制器也与多个通道相连
  - 根据设备类型检索系统控制表，找到第一个空闲设备，并检测分配的安全性
  - 设备分配后设备控制表，找到第一个与已分配设备相连的空闲设备控制器，若无则返回上面，查找下一个空闲设备
  - 同样方法查找通道，三个都空闲，就启动I/O设备传输信息

## 设备的回收

# SPOOLing假脱机技术

## 组成

- 输入井和输出井
- 输入缓冲区和输出缓冲区
- 输入进程和输出进程

## 特点

- 提高了I/O速度
- 设备并没有分配给任何进程
- 实现虚拟设备功能：设备是逻辑上的设备
- 既是一种速度匹配技术，也是一种虚拟设备技术

# 参考文献

天勤操作系统